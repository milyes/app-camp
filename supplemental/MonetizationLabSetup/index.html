
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://microsoft.github.io/app-camp/supplemental/MonetizationLabSetup/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>MonetizationLabSetup - Teams App Camp</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/labStyles.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="#35258F" data-md-color-accent="#091F2C">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deploying-the-sample-app-source-simulator-and-licensing-service" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Teams App Camp" class="md-header__button md-logo" aria-label="Teams App Camp" data-md-component="logo">
      
  <img src="../../assets/microsoftteams_appcamp-webheader3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Teams App Camp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MonetizationLabSetup
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/app-camp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/app-camp
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../new-adventure/00-welcome/" class="md-tabs__link">
          
  
  New Adventure

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../aad/A01-begin-app/" class="md-tabs__link">
          
  
  A Path

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../bespoke/B01-begin-app/" class="md-tabs__link">
          
  
  B Path

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../aad/ExtendedLabs/" class="md-tabs__link">
          
  
  Extended labs

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Resources/" class="md-tabs__link">
          
  
  Resources

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Teams App Camp" class="md-nav__button md-logo" aria-label="Teams App Camp" data-md-component="logo">
      
  <img src="../../assets/microsoftteams_appcamp-webheader3.png" alt="logo">

    </a>
    Teams App Camp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/app-camp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/app-camp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    New Adventure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            New Adventure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/00-welcome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to another App Camp adventure!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/01-create-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 - Create a new app with Teams Toolkit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/02-integrate-web-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 - Integrate business data with your app
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/03-add-link-unfurling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 - Link Unfurling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/04-add-ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 - Action message extensions with Open AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/05-add-sso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 - Single Sign-on and Microsoft Graph
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-adventure/06-run-in-outlook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 - Run your app in Microsoft Outlook
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    A Path
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            A Path
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/A01-begin-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A01 - Start with Azure Active Directory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/A02-after-teams-sso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A02 - Create a Teams app with Azure AD Teams SSO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/A03-after-apply-styling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A03 - Teams styling and themes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    B Path
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            B Path
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bespoke/B01-begin-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B01 - Start with a non-Azure Active Directory Identity System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bespoke/B02-after-teams-login/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B02 - Teams App with Bespoke Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bespoke/B03-after-teams-sso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B03 - Enable Azure AD Single Sign-On
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bespoke/B04-after-apply-styling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B04 - Teams styling and themes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Extended labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Extended labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/ExtendedLabs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Choose your own adventure!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/ConfigurableTab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a configurable tab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/Deeplink/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a Deep link to a personal Tab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/Dialog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a Dialog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/MeetingConfigurableTab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a Meeting app
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/MessagingExtension/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a Message Extension
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/Monetization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Selling Your SaaS-based Teams Extension
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aad/ExtendTeamsApp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extend teams app to Outlook and Microsoft365 app
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    More Information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../in-a-box/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lead your own App Camp
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "dfh6fjbr5x");
</script>

<p><img alt="Teams App Camp" src="/app-camp/assets/code-lab-banner.png" /></p>
<h1 id="deploying-the-sample-app-source-simulator-and-licensing-service">Deploying the sample App Source Simulator and Licensing service</h1>
<p>The lab <a href="/app-camp/aad/Monetization">Selling your SaaS-based Teams Extension</a> utilizes a sample "App Source" (which stands in for the real App Source or the Teams app store) and a licensing service (which you would write for your own application).</p>
<p>If you wish to install these services yourself, here are the instructions.</p>
<details class="note">
<summary>Table of Contents (open to display ►)</summary>
<ul>
<li><a href="#exercise-1-download-source-code-for-lab">Exercise 1: Download source code for lab</a></li>
<li><a href="#exercise-2--deploy-resources-to-azure">Exercise 2:  Deploy resources to Azure</a></li>
<li><a href="#step-1-update-arm-parameters-file">Step 1: Update ARM parameters file</a></li>
<li><a href="#step-2-overcoming-install-errors">Step 2: Overcoming install errors</a></li>
<li><a href="#step-3-deploy-the-arm-template-with-powershell">Step 3: Deploy the ARM template with PowerShell</a></li>
<li><a href="#step-4-deploy-the-applications-to-azure">Step 4: Deploy the applications to Azure</a></li>
<li><a href="#step-5-update-env-file-with-deployed-resources">Step 5: Update .env file with deployed resources.</a></li>
<li><a href="#exercise-3-set-application-permissions">Exercise 3: Set application permissions</a></li>
<li><a href="#step-1-return-to-the-northwind-orders-app-registration">Step 1: Return to the Northwind Orders app registration</a></li>
<li><a href="#step-2-add-permission-to-call-the-licensing-application">Step 2: Add permission to call the licensing application</a></li>
<li><a href="#step-2a-only-if-needed-add-permission-across-tenants">Step 2A (ONLY IF NEEDED): Add permission across tenants</a></li>
<li><a href="#step-3-consent-to-the-permission">Step 3: Consent to the permission</a></li>
<li><a href="#exercise-4-northwind-orders-calls-the-licensing-service">Exercise 4: Northwind Orders calls the licensing service</a></li>
<li><a href="#step-1-add-a-server-side-function-to-validate-the-user-has-a-license">Step 1: Add a server side function to validate the user has a license</a></li>
<li><a href="#step-2-add-a-server-side-api-to-validate-the-users-license">Step 2: Add a server side API to validate the user's license</a></li>
<li><a href="#step-3-add-client-pages-to-display-a-license-error">Step 3: Add client pages to display a license error</a></li>
<li><a href="#step-4-check-if-the-user-has-a-license">Step 4: Check if the user has a license</a></li>
<li><a href="#step-5-call-the-license-api">Step 5: Call the license API</a></li>
<li><a href="#exercise-5-run-the-application">Exercise 5: Run the application</a></li>
<li><a href="#step-1-run-teams-without-a-license">Step 1: Run Teams without a license</a></li>
<li><a href="#step-2-purchase-a-subscription-and-set-licensing-policy">Step 2: "Purchase" a subscription and set licensing policy</a></li>
<li><a href="#step-3-run-the-application-in-teams">Step 3: Run the application in Teams</a></li>
</ul>
</details>
<p>Over the course of these exercises you will complete the following lab goals.</p>
<ol>
<li>Deploy the <strong>AppSource</strong> simulator and sample SaaS fulfillment and licensing service in Microsoft Azure.</li>
<li>Observe the interactions between <strong>AppSource</strong> and a <strong>SaaS landing page</strong> in a simulated environment</li>
<li>Connect the Northwind Orders application to the sample <strong>SaaS licensing service</strong> to enforce licenses for Microsoft Teams users</li>
</ol>
<h2 id="features-added-in-this-lab">Features added in this lab</h2>
<ul>
<li><strong><em>*AppSource</em>* simulator</strong> enabling a customer can "purchase" a subscription to your application</li>
<li><strong>Sample web service</strong> that fulfills this purchase and manages licenses for Microsoft Teams users to use the Northwind Orders application</li>
<li><strong>Northwind Orders application</strong> checks to ensure Microsoft Teams users are licensed or displays an error page</li>
</ul>
<h2 id="lab-prerequisites">Lab prerequisites</h2>
<p>This lab requires the following prerequisites.</p>
<ol>
<li>An active Azure subscription on your own Azure tenant.</li>
<li>An active M365 tenant, which can be the one you created in the prerequisites lab.</li>
<li>PowerShell 7 (This is cross-platform and will run on MacOS and Linux)</li>
<li>.NET Core 3.1 SDK (This is cross-platform and will run on MacOS and Linux)</li>
<li>.NET Framework 4.8 Developer Pack</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to run or modify these applications locally, you may find it helpful to install <a href="https://visualstudio.microsoft.com/vs/" target="_blank">Visual Studio 2022</a> for Windows. The free <strong>Community</strong> edition will work fine. During installation, select the following modules to be added to Visual Studio.</p>
<ol>
<li>
<p>ASP.NET and web development</p>
</li>
<li>
<p>Azure development</p>
</li>
<li>
<p>Office/SharePoint development</p>
</li>
<li>
<p>.NET cross-platform development</p>
</li>
</ol>
</div>
<h3 id="install-the-prerequisites">Install the prerequisites</h3>
<ol>
<li>Install <a href="https://github.com/PowerShell/PowerShell/releases/tag/v7.1.4">PowerShell 7</a></li>
<li>
<p>Install the following PowerShell modules (You will need an elevated prompt)</p>
<ul>
<li><a href="https://github.com/microsoftgraph/msgraph-sdk-powershell#powershell-gallery">Microsoft Graph PowerShell SDK</a> </li>
</ul>
<p><code>powershell
  Install-Module Microsoft.Graph -AllowClobber -Force</code></p>
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-6.4.0&amp;WT.mc_id=m365-58890-cxa#installation">Azure Az PowerShell module</a></p>
<p><code>powershell
Install-Module -Name Az -Scope CurrentUser -Repository PSGallery -AllowClobber -Force</code>
3. Install <a href="https://dotnet.microsoft.com/download/dotnet/3.1">.NET Core 3.1 SDK</a>
4. <a href="https://dotnet.microsoft.com/download/dotnet-framework/thank-you/net48-developer-pack-offline-installer">.NET Framework 4.8 Developer Pack</a></p>
</li>
</ul>
</li>
</ol>
<h2 id="exercise-1-download-source-code-for-lab">Exercise 1: Download source code for lab</h2>
<p>To complete this lab you'll deploy the following to Azure. </p>
<ul>
<li>Northwind Web App - The Northwind SaaS application</li>
<li>License Service Web API - An API that serves as a licensing service</li>
<li>AppSource Simulator - An application that simulates the AppSource </li>
<li>SQL Server and database</li>
</ul>
<p>You'll create the three applications and their supporting infrastructure using automated deployment scripts called <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview">ARM templates</a>.</p>
<p><strong>Download the source code needed for these services</strong></p>
<ol>
<li>Go to <a href="https://github.com/OfficeDev/office-add-in-saas-monetization-sample">https://github.com/OfficeDev/office-add-in-saas-monetization-sample</a>.</li>
<li>Clone or download the project to your local machine.</li>
</ol>
<h2 id="exercise-2-deploy-resources-to-azure">Exercise 2:  Deploy resources to Azure</h2>
<p>In this exercise you will deploy resources into your Azure subscription using an ARM template. These resources will all share the same resource group. They include the three web applications and a SQL server instance with a database.</p>
<h3 id="step-1-update-arm-parameters-file">Step 1: Update ARM parameters file</h3>
<ol>
<li>In the project you just downloaded in Exercise 1, Step 2, go to folder <code>office-add-in-saas-monetization-sample/Deployment_SaaS_Resources/</code> in your text editor.</li>
<li>Open the <code>ARMParameters.json</code> file and note the following parameters.
    <code>text
        - webAppSiteName
        - webApiSiteName
        - resourceMockWebSiteName
        - domainName
        - directoryId (Directory (tenant) ID)
        - sqlAdministratorLogin
        - sqlAdministratorLoginPassword
        - sqlMockDatabaseName
        - sqlSampleDatabaseName</code></li>
<li>Enter a unique name for each web app and web site in the parameter list shown below because each one must have a unique name across all of Azure.  All of the parameters that correspond to web apps and sites in the following list end in <strong>SiteName</strong>.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you need assistance findinn your <strong>domainName</strong> and <strong>directoryId</strong>, please refer to this <a href="https://docs.microsoft.com/en-us/partner-center/find-ids-and-domain-names?WT.mc_id=m365-58890-cxa#find-the-microsoft-azure-ad-tenant-id-and-primary-domain-name">article</a>.</p>
</div>
<p>Based on the subscription you are using, you may change the location where your azure resources are deployed. To change this, find the <code>DeployTemplate.ps1</code> file and search for variable <code>$location</code>.     By default it is <code>centralus</code> but you can change it to a region near you, such as <code>eastus</code>.</p>
<p>Leave the rest of the configuration in file <code>ARMParameters.json</code> as is, this will be automatically filled in after scripts deploy the resources.</p>
<ol>
<li>
<p>In a Powershell 7 window, change to the <strong>./Deployment_SaaS_Resources</strong> directory.</p>
</li>
<li>
<p>Run the following command. You will be prompted to sign in and accept a <strong>Permissions requested</strong> dialog as shown below.</p>
<p><code>powershell
Connect-Graph -Scopes "Application.ReadWrite.All, Directory.AccessAsUser.All DelegatedPermissionGrant.ReadWrite.All Directory.ReadWrite.All"</code></p>
</li>
</ol>
<p><img alt="Graph consent" src="/app-camp/assets/screenshots/08-001.png" /></p>
<ol>
<li>Click <strong>Accept</strong>.</li>
</ol>
<p>Once accepted, the browser will redirect and show the below message. You can close the browser and continue with the PowerShell command line.</p>
<p><img alt="Graph consent redirect" src="/app-camp/assets/screenshots/08-001-1.png" /></p>
<ol>
<li>In the same PowerShell terminal window run <code>.\InstallApps.ps1</code>.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step adds <code>Microsoft Graph PowerShell</code> in Azure Active Directory under <a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/add-application-portal">Enterprise Applications</a> with the necessary permissions so we can create the needed applications for this particular exercise using its commands.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You might get an error as shown below. It depends on the execution policy settings in PowerShell. If you do get the error, <strong>move to <a href="#step-2-overcoming-install-errors">Step 2</a></strong>. If you do not get the error <strong>keep going</strong>.</p>
<p><img alt="execution policy" src="/app-camp/assets/screenshots/08-001-2.png" /></p>
</div>
<ol>
<li>Copy the values from the output and later you will need  these values to update the code and .<code>env</code> file for deploying add-ins. These values will also be pre-populated in <code>ARMParameters.json</code>. Do not change this file.</li>
<li>Note how the <code>ARMParameters.json</code> file is now updated with the values of applications deployed.</li>
<li>Since you did not get the PowerShell error, <a href="#step-3-deploy-the-arm-template-with-powershell">move to Step 3</a>.</li>
</ol>
<h3 id="step-2-overcoming-install-errors">Step 2: Overcoming install errors</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>This step is only needed if the previous step ended in an error.</strong></p>
</div>
<p>The error you experienced above is likely due to the execution policy of your PowerShell terminal. Here you will set the PowerShell execution policy to be less restrictive and then re-run the install script.</p>
<p>You will set the execution policy to <code>Bypass</code> for now. Read more on execution policies <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy?view=powershell-7.2&amp;WT.mc_id=m365-58890-cxa" target="_blank">here</a>.</p>
<ol>
<li>Run below PowerShell command.
    <code>powershell
    Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass</code></li>
<li>
<p>Now re-run <code>.\InstallApps.ps1</code></p>
<p>The script should now run to create all three applications in Azure AD. At the end of the script, your command line should display below information.:</p>
</li>
</ol>
<p><img alt="app id secret" src="/app-camp/assets/screenshots/08-002.png" /></p>
<ol>
<li>
<p>Copy the values from the output and later you will need  these values to update the code and .env file for deploying Add-ins. These values will also be pre-populated in <code>ARMParameters.json</code>. Do not change this file.</p>
</li>
<li>
<p>Notice how the <code>ARMParameters.json</code> file is now updated with the values of applications deployed.</p>
</li>
</ol>
<h3 id="step-3-deploy-the-arm-template-with-powershell">Step 3: Deploy the ARM template with PowerShell</h3>
<ol>
<li>Open PowerShell 7 and run the Powershell command <code>Connect-AzAccount</code>. This will redirect you to login page.</li>
<li>Confirm with the Global admin credentials. You will be redirected to a page displaying below.</li>
</ol>
<p><img alt="Azure CLI consent redirect" src="/app-camp/assets/screenshots/08-001-1.png" /></p>
<ol>
<li>Close the browser and continue with PowerShell. You will see similar output to that shown below in your command line, if everything is okay.</li>
</ol>
<p><img alt="AZ CLI" src="/app-camp/assets/screenshots/08-003.png" /></p>
<ol>
<li>Run the script <code>.\DeployTemplate.ps1</code>. 
    When prompted, enter the name of the resource group to create.</li>
</ol>
<p><img alt="AZ CLI" src="/app-camp/assets/screenshots/08-004-1.png" /></p>
<p>Your resources will start to get deployed one after the other and you'll see the output as shown below if everything is okay.</p>
<p><img alt="AZ CLI" src="/app-camp/assets/screenshots/08-004.png" /></p>
<p>You'll get a message on the command line that the ARM Template deployment was successfully as shown below.</p>
<p><img alt="AZ CLI" src="/app-camp/assets/screenshots/08-005.png" /></p>
<ol>
<li>Go to the <code>App registrations</code> in Azure AD in Azure portal. Use this <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredApps">link</a> to navigate to it.</li>
</ol>
<p>Under <strong>All applications</strong>,  filter with Display name <code>Contoso Monetization</code>.
You should see three apps as shown in the screen below:</p>
<p><img alt="AZ AD Apps" src="/app-camp/assets/screenshots/08-006.png" /></p>
<h3 id="step-4-deploy-the-applications-to-azure">Step 4: Deploy the applications to Azure</h3>
<p>Here you'll deploy the server side code for the three applications.</p>
<ol>
<li>In the command line, change to the <code>.\MonetizationCodeSample</code> directory.</li>
<li>Run the script <code>.\PublishSaaSApps.ps1</code>.</li>
<li>When prompted, enter the same resource group name you chose earlier.
    You will see the source code in your local machine getting built and packaged.</li>
</ol>
<p><img alt="Build Apps" src="/app-camp/assets/screenshots/08-007.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may see some warnings about file expiration, please ignore.</p>
</div>
<p>The final messages may look like the image below.</p>
<p><img alt="publish Apps" src="/app-camp/assets/screenshots/08-008.png" /></p>
<h3 id="step-5-complete-the-monetization-lab">Step 5: Complete the monetization lab</h3>
<p>At this point you should be able to complete the <a href="../../aad/Monetization/">Selling your SaaS-based Teams Extension</a> lab using these values in the .env file, and granting permission to the application your just registered.</p>
<pre><code>SAAS_API=https://(webApiSiteName).azurewebsites.net/api/Subscriptions/CheckOrActivateLicense
SAAS_SCOPES=api://(webApiClientId)/user_impersonation
OFFER_ID=contoso_o365_addin
</code></pre>
<p>Replace the values &lt;webApiSiteName&gt; and &lt;webApiClientId&gt; with the values from your <code>ARMParameters.json</code> file.</p>
<p>Try visiting the <strong>AppSource</strong> simulator, which is at <code>https://(webAppSiteName).azurewebsites.net</code>; you should be able to log in using your tenant administrator account. <strong>Don't</strong> purchase a subscription yet, however!</p>
<p><img src="https://pnptelemetry.azurewebsites.net/app-camp/labs/monetization-azure-setup" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>